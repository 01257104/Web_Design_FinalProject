<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Random Wikipedia Sentence Generator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        #output {
            border: 1px solid #ccc;
            padding: 10px;
            margin-top: 10px;
            min-height: 50px;
        }
    </style>
</head>
<body>
    <h1>Random Wikipedia Sentence Generator</h1>
    <label for="level">Number of Characters:</label>
    <input type="number" id="level" min="1" value="100">
    <button id="generate">Generate Sentence</button>
    
    <div id="output"></div>

    <script>
        async function fetchRandomWikipediaSummary() {
            try {
                const response = await fetch('https://en.wikipedia.org/w/api.php?action=query&format=json&prop=extracts&exintro=&explaintext=&generator=random&origin=*');
                if (!response.ok) throw new Error('Network response was not ok');

                const data = await response.json();
                const pages = data.query.pages;
                const pageId = Object.keys(pages)[0];
                const extract = pages[pageId]?.extract;

                return extract || null;  // 返回找到的文本或 null
            } catch (error) {
                console.error("Error fetching data:", error);
                return null;  // 返回 null 以表示獲取失敗
            }
        }

        function filterText(text) {
            // 使用正則表達式過濾掉非英文字符和標點符號
            return text.replace(/[^a-zA-Z.,;:'"!?() ]/g, '');
        }

        async function generateSentence() {
            const maxAttempts = 10;  // 設定最大嘗試次數
            let attempts = 0;

            while (attempts < maxAttempts) {
                const summary = await fetchRandomWikipediaSummary();
                if (summary) {
                    return filterText(summary);  // 返回有效文本並過濾
                }
                attempts++;
                await new Promise(resolve => setTimeout(resolve, 500));  // 每次重試前等待 500 毫秒
            }

            return "Unable to fetch text after multiple attempts.";  // 如果多次嘗試後仍然無法獲取文本
        }

        function truncateText(text, length) {
            return text.length <= length ? text : text.slice(0, length) + '...';
        }

        document.getElementById('generate').addEventListener('click', async () => {
            const level = parseInt(document.getElementById('level').value);
            const summary = await generateSentence();
            const truncatedSummary = truncateText(summary, level);
            document.getElementById('output').innerText = truncatedSummary;
        });
    </script>
</body>
</html>
